# HiSpeed Viewer

High-performance frame-by-frame video viewer for high-speed recordings. Can work with any recording given that you create a compatible json file describing it. Built to open files captured by [HiSpeed Trigger Cam](https://github.com/vilaemail/hispeed-trigger-cam-p40).

## Functionalities

### Frame viewer

- Frame-by-frame navigation with keyboard (Left/Right arrows, PgUp/PgDn, Home/End) and mouse wheel.
- Two viewer modes selectable from Settings:
    - **Single Frame** (default) - current frame displayed as large as possible.
    - **Filmstrip** - current frame large in the center, previous 4 and next 4 frames shown smaller on left and right.
- Timeline scrubber with segment markers highlighting high-speed sections.
- User positionable and customizable time overlay with offset setting.

### Pulling video files automatically

- Automatic sync from three source types:
    - **HTTP server** - connects to the capture app's built-in HTTP server.
    - **Local folder / USB drive** - monitors a folder path, handles plug/unplug gracefully.
    - **ADB** - pulls files from Android device via `adb pull` / `adb shell ls`.
- Files are fetched to a temp directory, SHA-256 verified against the JSON metadata, then moved to the videos directory.
- Remote modification detection with user approval before replacing local files.

## Installing

1. Getting the app
    - Downloading: You may download the EXE from [GitHub releases](https://github.com/vilaemail/hispeed-viewer/releases/). For verifying the GitHub release you can use the following key: `SHA1: 26417DE81F5AB33300DD9677C30ADC5853CE258B`
        ```
        signtool.exe verify /pa /v <path-to-exe>
        ```
    - Compiling your own: Clone the repo and build per instructions below.
2. To keep distributable small and most flexible you need to bring your own dependent programs such as ffmpeg and configure their location in the applications settings:
    - [FFmpeg](https://ffmpeg.org/download.html) - must be in PATH or configured in Settings
    - [ADB](https://developer.android.com/tools/adb) - only needed if using ADB source (optional)
3. After launching app you make sure to configure File->Settings and save settings.

## Disclaimer

Most of the code and project was generated by AI tools.

## Contributing

Pull requests are welcome, as long as the main app functionality keeps working and is as simple to use. There is a list of [TODOs](./TODO.md) which you may try to tackle.

## Building the app

### Requirements

- Windows 10/11 (scripts in `.\scripts` folder are for Windows)
- [Rust](https://rust-lang.org/tools/install/) 1.75+
- [FFmpeg](https://ffmpeg.org/download.html) - must be in PATH or configured in Settings
- [ADB](https://developer.android.com/tools/adb) - only needed if using ADB source (optional)
- [GitHub CLI](https://cli.github.com/) (`gh`) - only needed for `scripts\release.bat` (optional)
- `signtool.exe` from Windows SDK - only needed for `scripts\release.bat` (optional)

### Steps

1. Clone the repo.
1. Build debug and run with logs: `scripts\run-debug.bat`
1. Build release: `scripts\build-release.bat`
1. Release a version on GitHub: `scripts\release.bat vX.Y.Z`

## Scripts

| Script | Description |
|--------|-------------|
| `scripts\build-debug.bat` | Build debug binary |
| `scripts\run-debug.bat` | Build debug + run with `RUST_LOG=debug` logging |
| `scripts\build-release.bat` | Run tests + build optimized release binary to `release\latest.exe` |
| `scripts\release.bat v1.0.0` | Run tests + build release + tag + create GitHub release |

## Signing Setup

See [signing/README.md](signing/README.md).

## JSON Metadata Format

Each `.mp4` requires a matching `.json` file describing variable frame rate segments:

```json
{
  "fps": 960,
  "width": 1920,
  "height": 1080,
  "totalFrames": 1020,
  "frames": [
    { "count": 30, "fps": 30 },
    { "count": 480, "fps": 960 },
    { "count": 30, "fps": 30 }
  ],
  "file": "recording.mp4",
  "size": 77717547,
  "sha256": "84475984802a0d974eaf8eceb2ec5f068fd40add3273a858da6c78473960c26f"
}
```

## License

MIT
